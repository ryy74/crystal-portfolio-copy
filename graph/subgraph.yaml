specVersion: 1.0.0
indexerHints:
  prune: auto

schema:
  file: ./schema.graphql

dataSources:
  - kind: ethereum
    name: CrystalRouter
    network: monad-testnet
    source:
      address: "0xed8FeB0b185bf7842F46Ed0Ee4DBD0A13F68E3C7"
      abi: Crystal
      startBlock: 49389579
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript

      entities:
        # random shit
        - Account
        - UserId
        - Market
        - Order
        # - CloidSlot
        # order history
        - AccountOrderMap
        - AccountOrderShard
        - AccountOrderBatch
        - UserOrderMap
        - UserOrderShard
        - UserOrderBatch
        # open orders
        - AccountOpenOrderMap
        - AccountOpenOrderShard
        - AccountOpenOrderBatch
        - UserOpenOrderMap
        - UserOpenOrderShard
        - UserOpenOrderBatch
        # fills 
        - Fill
        - AccountFillMap
        - AccountFillShard
        - AccountFillBatch
        - UserFillMap
        - UserFillShard
        - UserFillBatch
        # trades
        - Taker
        - MarketRecentTrade
        - AccountTradeMap
        - AccountTradeShard
        - AccountTradeBatch
        - UserTradeMap
        - UserTradeShard
        - UserTradeBatch

        - Series
        - Candle

      abis:
        - name: Crystal
          file: ./abis/Crystal.json
        - name: ERC20
          file: ./abis/ERC20.json

      eventHandlers:
        - event: Fill(indexed address,indexed address,uint256,uint256)
          handler: handleOrderFilled
        - event: OrdersUpdated(indexed address,indexed address,bytes)
          handler: handleOrdersUpdated
        - event: Trade(indexed address,indexed address,bool,uint256,uint256,uint256,uint256)
          handler: handleTrade
        - event: MarketCreated(indexed bool,indexed address,indexed address,address,(address,uint256,string,string),(address,uint256,string,string),(uint256,uint256,uint256,uint256,uint256,uint256,uint256,uint256))
          handler: handleMarketCreated
        - event: UserRegistered(indexed bool,indexed address,indexed uint256)
          handler: handleUserRegistered
        - event: TokenCreated(indexed address,indexed address,string,string,string,string,string,string,string,string)
          handler: handleTokenCreated
        - event: Migrated(indexed address)
          handler: handleMigrated
        - event: LaunchpadTrade(indexed address,indexed address,bool,uint256,uint256,uint256,uint256)
          handler: handleLaunchpadTrade

      file: ./src/crystal.ts

  - kind: ethereum/contract
    name: CrystalVaultFactory
    network: monad-testnet
    source:
      address: "0x9FbbC911E84b78cb40439DF7d7065Eb1b68b527D"
      abi: CrystalVaultFactory
      startBlock: 49389715
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      abis:
        - name: CrystalVaultFactory
          file: ./abis/CrystalVaultFactory.json
        - name: ERC20
          file: ./abis/ERC20.json
      entities:
        - Token
        - Account
        - Vault
        - UserVaultPosition
        - Deposit
        - Withdrawal
      eventHandlers:
        - event: VaultDeployed(indexed address,address,address,address,uint256,uint256,bool,(string,string,string,string,string))
          handler: handleVaultDeployed
        - event: Deposit(indexed address,indexed address,uint256,uint256,uint256)
          handler: handleDeposit
        - event: Withdraw(indexed address,indexed address,uint256,uint256,uint256)
          handler: handleWithdraw
        - event: Locked(indexed address)
          handler: handleLocked
        - event: Unlocked(indexed address)
          handler: handleUnlocked
        - event: Closed(indexed address)
          handler: handleClosed
      file: ./src/vaultFactory.ts

templates:
  - name: Erc20Token
    kind: ethereum/contract
    network: monad-testnet
    source:
      abi: ERC20
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/crystal.ts
      entities:
        - LaunchpadPosition
      abis:
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
